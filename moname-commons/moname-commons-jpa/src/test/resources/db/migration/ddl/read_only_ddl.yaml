# https://docs.liquibase.com/concepts/changelogs/working-with-changelogs.html
#
# https://docs.liquibase.com/concepts/changelogs/changelog-formats.html
#
# https://docs.liquibase.com/concepts/changelogs/yaml-format.html
#
# https://docs.liquibase.com/change-types/home.html
#
# https://docs.liquibase.com/change-types/create-table.html
#
# https://docs.liquibase.com/workflows/liquibase-community/modify-sql.html
#
# https://docs.liquibase.com/concepts/changelogs/preconditions.html
#
# https://docs.liquibase.com/concepts/changelogs/property-substitution.html
#
# ${databaseChangeLog[].changeSet.id}
# Pattern: ISO 8601 (e.g.: 1970-01-01T00:00:00+00:00)
#
# {@link java.sql.Types}
# https://stackoverflow.com/a/28626825
#
# {@link spring.liquibase.parameters.*}
# https://docs.spring.io/spring-boot/docs/current/reference/html/application-properties.html#application-properties.data-migration.spring.liquibase.parameters
#
# MySQL 8.0 Reference Manual | Character Sets, Collations, Unicode | Specifying Character Sets and Collations | Database Character Set and Collation
# https://dev.mysql.com/doc/refman/8.0/en/charset-database.html
databaseChangeLog:
  - changeSet:
      author: kinlhp
      context: test
      id: 2022-04-02T05:51:13-03:00
      changes:
        - createTable:
            columns:
              - column:
                  autoIncrement: true
                  constraints:
                    notNullConstraintName: ${table-name}_id_nn
                    nullable: false
                    primaryKey: true
                    primaryKeyName: ${table-name}_pk
                  #
                  # ${incrementBy}
                  # https://forum.liquibase.org/t/incrementby-does-not-work-for-mysql-in-liquibase-4-17/7454
                  # liquibase.exception.ValidationErrors#checkDisallowedField
                  #incrementBy: ${increment-by}
                  name: id
                  remarks: Primary key for ${table-name} table.
                  startWith: 1
                  type: TINYINT
              - column:
                  constraints:
                    notNullConstraintName: ${table-name}_description_nn
                    nullable: false
                    unique: true
                    uniqueConstraintName: ${table-name}_description_uk
                  name: description
                  remarks: Description of the registry.
                  type: CHAR(1)
            remarks: Read-only entity test.
            tableName: ${table-name}
        - modifySql:
            dbms: mysql
            append:
              value: ENGINE=InnoDB DEFAULT CHARACTER SET=utf8mb4 COLLATE=utf8mb4_general_ci
      preConditions:
        - onFail: MARK_RAN
        - not:
            - tableExists:
                tableName: ${table-name}
